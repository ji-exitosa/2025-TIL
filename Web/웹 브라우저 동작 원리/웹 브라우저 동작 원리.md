참고한 유튜브 : https://www.youtube.com/watch?v=Mqh13dNI8jc
참고한 사이트 : https://yozm.wishket.com/magazine/detail/2909/

![[웹브라우저동작원리_00.png]]

  ![[웹브라우저동작원리_01.png]]
(하나의 작은 os, 운영체제 시스템 같은 느낌이기도 하다)

- 사용자 인터페이스 : 뒤로가기/앞으로가기/새로고침/주소창 등
- 브라우저 엔진 : 사용자 인터페이스에서 사용자가 입력한 무언가를 인식해서 렌더링 엔진한테 알려주는 역할
- **렌더링 엔진 : 웹사이트에 보여주는 Render(그려주는) 부분**
	- DOM
		- [ip 주소 찾기] 사용자 인터페이스 주소창에 naver.com 입력 -> DNS(Domain Name System)에 찾아가서 naver.com의 ip 주소를 찾음 -> 주소 가지고 방문 시도 - DNS cache에 저장해놔서 다음에는 바로 찾아올 수 있도록 하기도 함.
		- [찾아가서 서버에 html 요청 및 변환] 바이트 스트링 형태로 받음 -> (바이트스트링 -> html 인코딩. 보통 UTF-8 많이 씀) -> characters (우리가 읽을 수 있는 형태)로 변환 완료. 이걸 *문서화*라고 이해하면 될까?
		- [characters - > tokens] 읽고 하나하나 해석해서 의미있는 토큰 단위로 묶음. body 태그가 열렸고, span이 열렸고, 다시 닫혔고, body도 닫혔고, 이런식으로 분류해두고
		- [토큰을 의미있는 단위로 재해석] object 형태로! div 태그가 열리고 닫힌 한 쌍이 있다면, div 태그가 존재하고, attribute는 뭐가있고.. 이런걸 다 *객체화* 시킴 = 이걸 nodes 라고 부름
		  이제 이 노드간의 관계를 찾아야됨
		- [노드 간 관계를 설정함 - model 이라고 함 => DOM]
			- document object model
		  ![[웹브라우저동작원리_02.png]]![[웹브라우저동작원리_03.png]]
	- CSSOM(css 오브젝트 모델이라고 읽음)
		- link를 만났는데 href="style.css"를 만나면, ip주소에 다시 찾아가서 css 파일도 요청하러 감
		- 바이트스트링 -> 캐릭터화 -> 토큰화 -> 노드 -> cssom tree
		- ![[웹브라우저동작원리_04.png]]
	- Javascript 파일 가지러 감
		- 강력한 놈이고 요구사항도 많은 친구라서, javascript가 돌아가는 동안 DOM 생성을 멈춤. 다 그려놨는데 javascript가 뭔가 바꾸라고 하면 일 두번하니까 그냥 쉬면서 바꿀꺼 있는지 들어봄.
		  ![[웹브라우저동작원리_05.png]]
		  따라서 스크랩트 태그 위에 있으면 아래 있는 div 파일에 접근을 할  수가 없어서 에러남
		  Javascript가 Dom 생성을 막지 않는 방법도 있음. 태그에 'defer' 이라는 옵션이나 'async' 붙이면 됨.
	- Render Tree 
		- DOM + CSSOM 완성되면? the render tree 만듦
			  - head, meta 태그 등은 렌더트리에 가지고 오지 않음. 정말 화면에 보여지는 것만 가져옴
			  - span 태그가 display:none 이었따면? 렌더트리에는 안가져옴
	- Layout - Paint - Composit (그리는 과정)
		- Layout
			- 정확히 이 화면의 어디에 그릴건데?
			  ex. 반응형 웹 만들 때 % 많이 쓰는데, 이걸 px로 계산해야함
			- 자주 바꾸는건 비용이 많이 듦. 새로 다 그려야돼서 성능에 영향을 줄 수 있음
		  - Paint
			  - 한 페이지에서 다 그리는거 아님. 약간 포토샵 레이아웃처럼 여러개 레이아웃에 각각 그림
			  - 만약에 한페이지에 다 그렸는데 뭐 하나 바뀌면 열받으니까ㅠㅠ 레이어 나눠서 그리면 뭔가 바꼈을때 그 레이어를 찾아가서 걔만 다시 그리면 되니까 효율적임
		  - composit
			  - 포토샵 기준 레이어 합치기 같은 느낌
		  - 그리는 과정 재실행 되는 케이스 (Reflow 될 때)
			  - 페이지 초기 렌더링 (최초 layout 생성 과정)
			  - 윈도우 리사이징 시, viewport 크기 변경 시
			  - 노드 추가/제거 시
			  - 요소의 위치, 크기 변경시 (left, top, margin, padding, border, width, height 등)
			  - 폰트 변경(텍스트 내용)과 이미지 크기 변경(크기가 다른 이미지로 변경 등)
	- 관련 QNA
		  - javascript를 아래 쓰는 이유는 이해했는데, 그럼 왜 css는 위에서 불러올까?
		  - 어차피 DOM 완성되면 CSSOM 기다리기 때문에 css까지 다 불러와져야 화면이 그려짐
	- 성능 개선 방법
		- 소스 사이즈 줄이기, 바이트 수 줄이기
		- 외부에서 가져오는 리소스 양 줄이기 (media 쿼리, 불필요한 파일 나중에)
		- 외부에서 가져오는 횟수 줄이기 (인라인)
			- ex. css, javascript 파일 가져오기.. 내가 인천에 있는데 부산가서 다시 가져와야되니까
			- 이 페이지를 위해서 만든 간단한 css 파일이면, 따로 빼지 않고 인라인으로 스타일 주는게 더 좋을 때도 있긴 함. 물론 다른데서 또 사용 하는거면 유지보수 측면에서는 안좋아 질 수도 있음
		- reflow, repaint 줄이기
			- position left right 하면 reflow 하게되니까 transition 써서 움직이는게 도움이 됨
			- 애니메이션 1px씩 움직이는 것 보다는 3px씩 더 크게 움직이는게 성능에는 더 도움이 됨
		- 


